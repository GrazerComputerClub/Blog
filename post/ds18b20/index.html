<!DOCTYPE html>
<html lang="de-de">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://blog.gc2.at"
        },
        "articleSection" : "post",
        "name" : "Temperatursensor DS18B20",
        "headline" : "Temperatursensor DS18B20",
        "description" : "<p>Mit dem günstigen Sensor DS18B20 und einem Widerstand kann ganz einfach über einen GPIO Pin die Umgebungstemperatur ausgelesen werden. Dazu wird noch nicht mal eine Library oder ein Programm benötigt. Alles Nötige ist im Linux-Kernel integriert.
</p>",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-03-26 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-03-26 00:00:00 &#43;0000 UTC",
        "url" : "https://blog.gc2.at/post/ds18b20/",
        "wordCount" : "350",
        "image" : https://blog.gc2.atimg/18B20.jpg",
        "keywords" : [ "Blog" ]   
    }
    </script>


 <title>Temperatursensor DS18B20 </title>


<meta name="description" content="Blog des Grazer Computer Club - GC2" />



<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link href="https://blog.gc2.at/css/style.css?v=1600206078" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://blog.gc2.at/css/custom.css?v=1600206078" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">


<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	if (window.sessionStorage) {
		var GA_SESSION_STORAGE_KEY = 'ga:clientId';
		ga('create', 'UA-130665257-1', {
	    'storage': 'none',
	    'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
	   });
	   ga(function(tracker) {
	    sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
	   });
   }
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">

  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fas fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/ccc">CCC</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/gc2">GC2</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/programmierung">Programmierung</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi">Raspberry Pi</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi-zero">Raspberry Pi Zero</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/uc">uC</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    
    <li>
      <a href="https://twitter.com/_gc2_" data-animate-hover="pulse" class="twitter" target="_blank">
        <i class="fab fa-twitter-square" title="twitter"></i>
        <span class="screen-reader-text">twitter</span>
      </a>
    </li>
    

    

    
    <li>
      <a href="mailto:blog@gc2.at" data-animate-hover="pulse" class="email">
        <i class="fas fa-envelope" title="email"></i>
        <span class="screen-reader-text">email</span>
      </a>
    </li>
    

    

    


    
    <li>
      <a href="https://github.com/GrazerComputerClub/" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fab fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    


    

    
    <li>
      <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
        <i class="fas fa-rss" title="rss"></i>
        <span class="screen-reader-text">rss</span>
      </a>
    </li>
    


  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> GC2 Blog </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fas fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/index.html">Blog (Deutsch)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://grazercomputerclub.github.io/BlogEN/index.html">Blog (English)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/impressum/">Impressum</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="http://gc2.at">Hauptseite</a>
          
        </li>
        
      </ul>
    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  
  
    
  
  
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image'  data-background="https://blog.gc2.at/img/18B20.jpg">
      </div>
      
        <div class="entry-meta">
          <span class="date">26 March</span>	<span> / </span>

          <span class="author">
            <a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a>
          </span>


          
          <span class="category">
            <span> / </span>

            <a href="/categories/raspberry-pi">Raspberry Pi</a>
          </span>
          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'> Temperatursensor DS18B20</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              <p>Mit dem günstigen Sensor DS18B20 und einem Widerstand kann ganz einfach über einen GPIO Pin die Umgebungstemperatur ausgelesen werden. Dazu wird noch nicht mal eine Library oder ein Programm benötigt. Alles Nötige ist im Linux-Kernel integriert.
</p>

<h2 id="beschreibung">Beschreibung</h2>

<p>Mit dem 1-Wire Sensor DS18B20 von Dallas oder einen eine kompatiblen Sensor, kann ganz einfach die Umgebungstemperatur gemessen werden. Man benötigt lediglich den Sensor einen Pull-up Widerstand und einen Device Tree Eintrag in der Konfigurationsdatei. Dann steht der Temperaturwert über das virtuelle Filesystem zur Verfügung. Eine extra Software oder Library ist nicht nötig.</p>

<h2 id="anschluss">Anschluss</h2>

<p>Der 1-Wire Sensor wird mit 3,3 V versorgt und über den GPIO-Pin 4 erfolgt die standardisierte Kommunikation. Lediglich einen zusätzlichen Pull-up Widerstand mit 4,7 KOhm muss man noch hinzuschalten.</p>

<p><img src="../../img/18B20_Schaltplan.png" alt="DS18B20 Schaltplan" /></p>

<p><img src="../../img/18B20_Steckplatine.png" alt="DS18B20 Steckplatine" /></p>

<h2 id="konfiguration">Konfiguration</h2>

<p>Es muss lediglich der 1-Wire-Bus über einen Device Tree Eintrag in der Konfigurationsdatei &ldquo;config.txt&rdquo; parametriert werden. Dadurch werden automatisch beim Starten die entsprechenden Kernel-Module (w1_gpio, w1_therm und wire) geladen.</p>

<pre><code>dtoverlay=w1-gpio,gpiopin=4,pullup=on
</code></pre>

<p>Im Betrieb kann das Kernelmodul mit folgendem Aufruf geladen werden:</p>

<pre><code>sudo dtoverlay w1-gpio gpiopin=4 pullup=on
</code></pre>

<h2 id="zugriff">Zugriff</h2>

<p>Nach einem Neustart ist bereits alles geladen und der Sensor über das virtuelle Dateisystem auslesbar. Die Identifizierung aller Sensoren erfolgt über eine eindeutige ID-Nummer, die in der Datei &ldquo;w1_master_slaves&rdquo; aufgelistet sind.</p>

<pre><code>ls  /sys/bus/w1/devices/
</code></pre>

<pre><code>28-03089779799c  w1_bus_master1
</code></pre>

<pre><code>cat /sys/bus/w1/devices/w1_bus_master1/w1_master_slaves
</code></pre>

<pre><code>28-03089779799c
</code></pre>

<pre><code>cat  /sys/bus/w1/devices/28-03089779799c/w1_slave
</code></pre>

<pre><code>8d 01 55 05 7f a5 a5 66 9c : crc=9c YES
8d 01 55 05 7f a5 a5 66 9c t=24812
</code></pre>

<p>Der ausgelesene Wert t muss noch durch 1000 dividiert werden um auf °C zu kommen.
Diese Aufgabe kann man auch mit einem kleinen Python Programm &lsquo;/usr/local/bin/w1-temp.py&rsquo; umsetzen.</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#60a0b0;font-style:italic">#!/usr/bin/python</span>
<span style="color:#60a0b0;font-style:italic"># -*- coding: utf-8 -*-</span>

<span style="color:#60a0b0;font-style:italic"># read slave list from master 1</span>
<span style="color:#007020">file</span> <span style="color:#666">=</span> <span style="color:#007020">open</span>(<span style="color:#4070a0">&#39;/sys/devices/w1_bus_master1/w1_master_slaves&#39;</span>)
w1_slaves <span style="color:#666">=</span> <span style="color:#007020">file</span><span style="color:#666">.</span>readlines()
<span style="color:#007020">file</span><span style="color:#666">.</span>close()

<span style="color:#60a0b0;font-style:italic"># for each slave</span>
<span style="color:#007020;font-weight:bold">for</span> line <span style="color:#007020;font-weight:bold">in</span> w1_slaves:
  <span style="color:#60a0b0;font-style:italic"># get slave id</span>
  w1_slave <span style="color:#666">=</span> line<span style="color:#666">.</span>split(<span style="color:#4070a0">&#34;</span><span style="color:#4070a0;font-weight:bold">\n</span><span style="color:#4070a0">&#34;</span>)[<span style="color:#40a070">0</span>]
  <span style="color:#60a0b0;font-style:italic"># read temp from slave id</span>
  <span style="color:#007020">file</span> <span style="color:#666">=</span> <span style="color:#007020">open</span>(<span style="color:#4070a0">&#39;/sys/bus/w1/devices/&#39;</span> <span style="color:#666">+</span> <span style="color:#007020">str</span>(w1_slave) <span style="color:#666">+</span> <span style="color:#4070a0">&#39;/w1_slave&#39;</span>)
  filecontent <span style="color:#666">=</span> <span style="color:#007020">file</span><span style="color:#666">.</span>read()
  <span style="color:#007020">file</span><span style="color:#666">.</span>close()
  <span style="color:#60a0b0;font-style:italic"># calc and show temp</span>
  stringvalue <span style="color:#666">=</span> filecontent<span style="color:#666">.</span>split(<span style="color:#4070a0">&#34;</span><span style="color:#4070a0;font-weight:bold">\n</span><span style="color:#4070a0">&#34;</span>)[<span style="color:#40a070">1</span>]<span style="color:#666">.</span>split(<span style="color:#4070a0">&#34; &#34;</span>)[<span style="color:#40a070">9</span>]
  temperature <span style="color:#666">=</span> <span style="color:#007020">float</span>(stringvalue[<span style="color:#40a070">2</span>:]) <span style="color:#666">/</span> <span style="color:#40a070">1000</span>

  <span style="color:#007020;font-weight:bold">print</span>(<span style="color:#4070a0">&#39;</span><span style="color:#70a0d0;font-style:italic">%4.1f</span><span style="color:#4070a0"> °C&#39;</span> <span style="color:#666">%</span> temperature)</code></pre></td></tr></table>
</div>
</div>
<pre><code>python3 /usr/local/bin/w1-temp.py
</code></pre>

<pre><code>26.2 °C
</code></pre>
            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  
    <div class="entry-categories"><p><span>Kategorie</span>
  
    
    <a href="/categories/raspberry-pi" title="View all posts in Raspberry Pi">Raspberry Pi</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  

</p></div>	</div>

	
<div class="author-meta">

  <div class="author">
    	
    <img alt='Martin Strohmayer' src="https://www.gravatar.com/avatar/dc376a825706457b68caa281714897d5?s=100&d=identicon" class='avatar avatar-72 photo' height='72' width='72'>
    
    <span>
      Geschrieben von:<a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a> </span>
    </div>
    <div class="bio">
      
      
      <p>Softwareentwickler und Raspberry Pi Enthusiast.</p>
        
      
	
      

    


  
  <a class="twitter" target="_blank"
  href="https://twitter.com/m_stroh">
  <i class="fab fa-twitter-square"
  title="twitter icon"></i>
</a>




<a class="email" target="_blank"
href="mailto:martin.strohmayer@gc2.at">
<i class="fas fa-envelope"
title="email icon"></i>
</a>







<a class="github" target="_blank"
href="https://github.com/mstroh76">
<i class="fab fa-github"
title="github icon"></i>
</a>









</div>
</div>

</div>
</div>

<section id="comments" class="comments">




<script src="https://utteranc.es/client.js"
        repo="GrazerComputerClub/Blog"
        issue-term="title"
        
        theme="github-light"
        
        crossorigin="anonymous"
        async>
</script>


  

  




</section>
</div>

 



    </div>

    
<footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> GC2 Blog </a>
    
	</h1>

			
			<p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        
        <li>
        <a href="https://twitter.com/_gc2_"  class="twitter" target="_blank">
            <i class="fab fa-twitter-square" title="twitter"></i>
            <span class="screen-reader-text">twitter</span>
        </a>
        </li>
        

        

        
        <li>
        <a href="mailto:blog@gc2.at"  class="email">
            <i class="fas fa-envelope" title="email"></i>
            <span class="screen-reader-text">email</span>
        </a>
        </li>
        

        

        


        
        <li>
        <a href="https://github.com/GrazerComputerClub/"  class="github" target="_blank">
            <i class="fab fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        


        

        
        <li>
        <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
            <i class="fas fa-rss" title="rss"></i>
            <span class="screen-reader-text">rss</span>
        </a>
        </li>
        

				</ul>	<div class="design-credit">
		
		<p>CC-BY-4.0 <a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
		
		<p>2018, Grazer Computer Club e. V.</p>
		
		<p>Nederburg Hugo Theme by <a href="https://appernetic.io">Appernetic</a>.</p>
		
	</div>
</footer>

  </div>
  <script src="https://blog.gc2.at/js/jquery.min.js"></script>
<script src="https://blog.gc2.at/js/jquerymigrate.js"></script>
<script src="https://blog.gc2.at/js/production.min.js?v=1600206078"></script>

</body>
</html>
