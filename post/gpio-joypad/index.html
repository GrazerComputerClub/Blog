<!DOCTYPE html>
<html lang="de-de">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://blog.gc2.at"
        },
        "articleSection" : "post",
        "name" : " GPIO-Eingang zur Joypad Emulation",
        "headline" : " GPIO-Eingang zur Joypad Emulation",
        "description" : "<p>Die Anforderung, dass man mit GPIO-Eingängen eine virtuelle Joypad am System erstellt, ist mit dem Raspberry Pi sehr einfach umzusetzen. Ein paar GPIOs und ein paar Zeilen Python-Code reichen.
</p>",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-02-16 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-02-16 00:00:00 &#43;0000 UTC",
        "url" : "https://blog.gc2.at/post/gpio-joypad/",
        "wordCount" : "1037",
        "image" : https://blog.gc2.atimg/GPIO-Input-Joypad.jpg",
        "keywords" : [ "Blog" ]   
    }
    </script>


 <title> GPIO-Eingang zur Joypad Emulation </title>


<meta name="description" content="Blog des Grazer Computer Club - GC2" />



<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link href="https://blog.gc2.at/css/style.css?v=1583694825" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://blog.gc2.at/css/custom.css?v=1583694825" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">


<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	if (window.sessionStorage) {
		var GA_SESSION_STORAGE_KEY = 'ga:clientId';
		ga('create', 'UA-130665257-1', {
	    'storage': 'none',
	    'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
	   });
	   ga(function(tracker) {
	    sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
	   });
   }
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">

  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fas fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/ccc">CCC</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/gc2">GC2</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/programmierung">Programmierung</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi">Raspberry Pi</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi-zero">Raspberry Pi Zero</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/uc">uC</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    
    <li>
      <a href="https://twitter.com/_gc2_" data-animate-hover="pulse" class="twitter" target="_blank">
        <i class="fab fa-twitter-square" title="twitter"></i>
        <span class="screen-reader-text">twitter</span>
      </a>
    </li>
    

    

    
    <li>
      <a href="mailto:blog@gc2.at" data-animate-hover="pulse" class="email">
        <i class="fas fa-envelope" title="email"></i>
        <span class="screen-reader-text">email</span>
      </a>
    </li>
    

    

    


    
    <li>
      <a href="https://github.com/GrazerComputerClub/" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fab fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    


    

    
    <li>
      <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
        <i class="fas fa-rss" title="rss"></i>
        <span class="screen-reader-text">rss</span>
      </a>
    </li>
    


  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> GC2 Blog </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fas fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/index.html">Blog (Deutsch)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://grazercomputerclub.github.io/BlogEN/index.html">Blog (English)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/impressum/">Impressum</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="http://gc2.at">Hauptseite</a>
          
        </li>
        
      </ul>
    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  
  
    
  
  
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image'  data-background="https://blog.gc2.at/img/GPIO-Input-Joypad.jpg">
      </div>
      
        <div class="entry-meta">
          <span class="date">16 February</span>	<span> / </span>

          <span class="author">
            <a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a>
          </span>


          
          <span class="category">
            <span> / </span>

            <a href="/categories/raspberry-pi">Raspberry Pi</a>
          </span>
          
          <span class="category">
            <span> / </span>

            <a href="/categories/programmierung">Programmierung</a>
          </span>
          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'>  GPIO-Eingang zur Joypad Emulation</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              <p>Die Anforderung, dass man mit GPIO-Eingängen eine virtuelle Joypad am System erstellt, ist mit dem Raspberry Pi sehr einfach umzusetzen. Ein paar GPIOs und ein paar Zeilen Python-Code reichen.
</p>

<h2 id="aufgabe">Aufgabe</h2>

<p>Wenn man mit einem Raspberry Pi alten Konsolen wie Gameboy, NES Emulieren will benötigt man eigentlich ein Joypad oder eine Tastatur. Tasten-Eingaben mit GPIO Eingänge zu erzeugen ist sehr einfach, aber wenn man ein Joypad Emulieren möchte, so geht das nicht ohne einen entsprechendes Programm. Mit Python und uinput kann aber so ein Programm erzeugen. Dann kann man mit 8 Tasten ein virtuelles Joypad erstellen, das kompatibel mit NES bzw. Gameboy Eingaben ist. Dies kann für Game-HATs oder auch Gaming Gehäuse für den Raspberry Pi verwendet werden.</p>

<h2 id="uinput-interface">uinput Interface</h2>

<p>uinput ist ein Kernelmodul, mit dem Eingabegeräte aus dem Userspace emuliert werden können. Durch Schreiben auf das Gerät /dev/uinput kann ein Programm ein virtuelles Eingabegerät mit bestimmten Funktionen erstellen. Dieses Eingabegerät kann eine Tastatur, Maus oder Joypad bzw. Joystick sein.<br />
Der Zugriff erfolgt bei Python über das uinput Interface (import uinput). So ist die Erstellung eines virtuellen Joypad sehr einfach.</p>

<pre><code>sudo apt-get install python3-uinput
</code></pre>

<h2 id="gpio-schaltplan">GPIO Schaltplan</h2>

<p>Es werden mindestens 8 GPIO-Eingänge benötigt:</p>

<ul>
<li>Rauf</li>
<li>Runter</li>
<li>Links</li>
<li>Rechts</li>
<li>Start</li>
<li>Select</li>
<li>A</li>
<li>B</li>
</ul>

<p><img src="../../img/GPIO-Input-Joypad.png" alt="Schaltplan GPIO-Input" /></p>

<h2 id="gpio-joypad">GPIO Joypad</h2>

<p>Das Programm führt folgende Schritte aus:</p>

<ul>
<li>Interfaces / Bibliotheken einbinden (GPIO, uinput)</li>
<li>GPIO-Eingänge konfigurieren</li>
<li>Joypad Achsen und Tasten anlegen bzw. bekannt geben</li>
<li>Bei entsprechenden GPIO-Eingang die Achse in X- oder Y-Richtung verschieben</li>
<li>Bei entsprechenden GPIO-Eingang die Buttons drücken und rücksetzen</li>
</ul>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#4070a0">&#34;&#34;&#34; rpi-gpio-jstk.py by Chris Swan 9 Aug 2012
</span><span style="color:#4070a0">based on python-uinput/examples/joystick.py by tuomasjjrasanen
</span><span style="color:#4070a0">https://github.com/tuomasjjrasanen/python-uinput/blob/master/examples/joystick.py
</span><span style="color:#4070a0">&#34;&#34;&#34;</span>


<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">uinput</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">time</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">RPi.GPIO</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">GPIO</span>

BTN_FIRE1<span style="color:#666">=</span><span style="color:#40a070">15</span>
BTN_FIRE2<span style="color:#666">=</span><span style="color:#40a070">14</span>
BTN_UP<span style="color:#666">=</span><span style="color:#40a070">16</span>
BTN_DOWN<span style="color:#666">=</span><span style="color:#40a070">21</span>
BTN_LEFT<span style="color:#666">=</span><span style="color:#40a070">26</span>
BTN_RIGHT<span style="color:#666">=</span><span style="color:#40a070">20</span>
BTN_SELECT<span style="color:#666">=</span><span style="color:#40a070">3</span>
BTN_START<span style="color:#666">=</span><span style="color:#40a070">19</span>
GPIO<span style="color:#666">.</span>setmode(GPIO<span style="color:#666">.</span>BCM)
<span style="color:#60a0b0;font-style:italic"># Up, Down, left, right, fire</span>
<span style="color:#60a0b0;font-style:italic">#GPIO.setwarnings(False)</span>
GPIO<span style="color:#666">.</span>setup(BTN_UP, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_DOWN, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_LEFT, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_RIGHT, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_FIRE1, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_FIRE2, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_SELECT, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)
GPIO<span style="color:#666">.</span>setup(BTN_START, GPIO<span style="color:#666">.</span>IN, pull_up_down<span style="color:#666">=</span>GPIO<span style="color:#666">.</span>PUD_UP)

events <span style="color:#666">=</span> (uinput<span style="color:#666">.</span>BTN_SOUTH, uinput<span style="color:#666">.</span>BTN_EAST, uinput<span style="color:#666">.</span>BTN_START, uinput<span style="color:#666">.</span>BTN_SELECT, uinput<span style="color:#666">.</span>ABS_X <span style="color:#666">+</span> (<span style="color:#40a070">0</span>, <span style="color:#40a070">100</span>, <span style="color:#40a070">0</span>, <span style="color:#40a070">0</span>), uinput<span style="color:#666">.</span>ABS_Y <span style="color:#666">+</span> (<span style="color:#40a070">0</span>, <span style="color:#40a070">100</span>, <span style="color:#40a070">0</span>, <span style="color:#40a070">0</span>))


device <span style="color:#666">=</span> uinput<span style="color:#666">.</span>Device(events)

<span style="color:#60a0b0;font-style:italic"># Bools to keep track of movement</span>
fire1 <span style="color:#666">=</span> False
fire2 <span style="color:#666">=</span> False
start <span style="color:#666">=</span> False
select <span style="color:#666">=</span> False
up <span style="color:#666">=</span> False
down <span style="color:#666">=</span> False
left <span style="color:#666">=</span> False
right <span style="color:#666">=</span> False

<span style="color:#60a0b0;font-style:italic"># Center joystick</span>
<span style="color:#60a0b0;font-style:italic"># syn=False to emit an &#34;atomic&#34; (50, 50) event.</span>
device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_X, <span style="color:#40a070">50</span>, syn<span style="color:#666">=</span>False)
device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_Y, <span style="color:#40a070">50</span>)

<span style="color:#007020;font-weight:bold">while</span> True:
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> start) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_START)):  <span style="color:#60a0b0;font-style:italic"># start button pressed</span>
    start <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_START, <span style="color:#40a070">1</span>)
  <span style="color:#007020;font-weight:bold">if</span> start <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_START):              <span style="color:#60a0b0;font-style:italic"># start button released</span>
    start <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_START, <span style="color:#40a070">0</span>) 
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> select) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_SELECT)):  <span style="color:#60a0b0;font-style:italic"># select button pressed</span>
    select <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_SELECT, <span style="color:#40a070">1</span>)
  <span style="color:#007020;font-weight:bold">if</span> select <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_SELECT):              <span style="color:#60a0b0;font-style:italic"># select button released</span>
    select <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_SELECT, <span style="color:#40a070">0</span>) 
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> fire1) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_FIRE1)):  <span style="color:#60a0b0;font-style:italic"># Fire1 button pressed</span>
    fire1 <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_SOUTH, <span style="color:#40a070">1</span>)
  <span style="color:#007020;font-weight:bold">if</span> fire1 <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_FIRE1):              <span style="color:#60a0b0;font-style:italic"># Fire1 button released</span>
    fire1 <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_SOUTH, <span style="color:#40a070">0</span>) 
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> fire2) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_FIRE2)):  <span style="color:#60a0b0;font-style:italic"># Fire2 button pressed</span>
    fire2 <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_EAST, <span style="color:#40a070">1</span>)
  <span style="color:#007020;font-weight:bold">if</span> fire2 <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_FIRE2):              <span style="color:#60a0b0;font-style:italic"># Fire2 button released</span>
    fire2 <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>BTN_EAST, <span style="color:#40a070">0</span>)
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> up) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_UP)):   <span style="color:#60a0b0;font-style:italic"># Up button pressed</span>
    up <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_Y, <span style="color:#40a070">0</span>)          <span style="color:#60a0b0;font-style:italic"># Zero Y</span>
  <span style="color:#007020;font-weight:bold">if</span> up <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_UP):               <span style="color:#60a0b0;font-style:italic"># Up button released</span>
    up <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_Y, <span style="color:#40a070">50</span>)        <span style="color:#60a0b0;font-style:italic"># Center Y</span>
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> down) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_DOWN)): <span style="color:#60a0b0;font-style:italic"># Down button pressed</span>
    down <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_Y, <span style="color:#40a070">100</span>)        <span style="color:#60a0b0;font-style:italic"># Max Y</span>
  <span style="color:#007020;font-weight:bold">if</span> down <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_DOWN):             <span style="color:#60a0b0;font-style:italic"># Down button released</span>
    down <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_Y, <span style="color:#40a070">50</span>)        <span style="color:#60a0b0;font-style:italic"># Center Y</span>
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> left) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_LEFT)): <span style="color:#60a0b0;font-style:italic"># Left button pressed</span>
    left <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_X, <span style="color:#40a070">0</span>)          <span style="color:#60a0b0;font-style:italic"># Zero X</span>
  <span style="color:#007020;font-weight:bold">if</span> left <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_LEFT):             <span style="color:#60a0b0;font-style:italic"># Left button released</span>
    left <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_X, <span style="color:#40a070">50</span>)        <span style="color:#60a0b0;font-style:italic"># Center X</span>
  <span style="color:#007020;font-weight:bold">if</span> (<span style="color:#007020;font-weight:bold">not</span> right) <span style="color:#007020;font-weight:bold">and</span> (<span style="color:#007020;font-weight:bold">not</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_RIGHT)):<span style="color:#60a0b0;font-style:italic"># Right button pressed</span>
    right <span style="color:#666">=</span> True
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_X, <span style="color:#40a070">100</span>)        <span style="color:#60a0b0;font-style:italic"># Max X</span>
  <span style="color:#007020;font-weight:bold">if</span> right <span style="color:#007020;font-weight:bold">and</span> GPIO<span style="color:#666">.</span><span style="color:#007020">input</span>(BTN_RIGHT):            <span style="color:#60a0b0;font-style:italic"># Right button released</span>
    right <span style="color:#666">=</span> False
    device<span style="color:#666">.</span>emit(uinput<span style="color:#666">.</span>ABS_X, <span style="color:#40a070">50</span>)        <span style="color:#60a0b0;font-style:italic"># Center X</span>
  time<span style="color:#666">.</span>sleep(<span style="color:#666">.</span><span style="color:#40a070">02</span>)  <span style="color:#60a0b0;font-style:italic"># Poll every 20ms (otherwise CPU load gets too high)</span></code></pre></td></tr></table>
</div>
</div>
<pre><code>sudo python3 joypad.py &amp;
</code></pre>

<p>Wenn der Fehler &ldquo;OSError: [Errno 19] Failed to open the uinput device: No such device&rdquo; ausgegeben wird, so ist das uinput Device nicht verfügbar. Dann kann mit &ldquo;sudo modprobe uinput&rdquo; das Kernel-Modul geladen werden.</p>

<p>Testen kann man die Funktion mit dem Joystick Testprogramm &ldquo;jstest&rdquo;.</p>

<pre><code>sudo apt-get install joystick
jstest /dev/input/js0
</code></pre>

<pre><code>Driver version is 2.1.0.
Joystick (python-uinput) has 2 axes (X, Y)
and 4 buttons (BtnA, BtnB, BtnSelect, BtnStart).
Testing ... (interrupt to exit)
Axes:  0:     0  1:     0 Buttons:  0:off  1:off  2:off  3:off 
</code></pre>

<h2 id="testen-mit-gameboy-emulation">Testen mit Gameboy Emulation</h2>

<p>Nun kann man das Joypad im Einsatz mit einer Gameboy Color Emulation testen.
Zuerst muss der Emulator Gambatte aber noch kompiliert und installiert werden, da er nicht im Raspbian vorhanden ist. Bei Raspjamming Image ist er bereits vorinstalliert.</p>

<pre><code>git clone https://github.com/sinamas/gambatte
cd gambatte
sudo apt-get install scons libsdl1.2-dev zlib1g-dev
sed -i &quot;2 i\global_cflags = global_cflags + \' -mcpu=arm1176jzf-s -mfloat-abi=hard -mfpu=vfp\'&quot; libgambatte/SConstruct
sed -i &quot;4 i\cflags = cflags + \' -mcpu=arm1176jzf-s -mfloat-abi=hard -mfpu=vfp\'&quot; gambatte_sdl/SConstruct
./build_sdl.sh
sudo mv gambatte_sdl/gambatte_sdl /usr/local/bin/gambatte
</code></pre>

<p>Benötigte Laufzeit Bibliotheken:<br />
sudo apt-get install libsdl1.2debian zlib1g</p>

<p>Nun wird noch ein Freeware Gameboy Color Spiel wie z.B. Skoardy benötigt.</p>

<pre><code>wget http://www.skoardy.com/skoardygb.zip
unzip skoardygb.zip Skoardy.gb
rm skoardygb.zip
</code></pre>

<p>Die Joypad Tasten müssen beim Gambatte Emulator als Parameter übergeben werden. Dabei gilt:</p>

<p>jsNaM+ &hellip; Joystick N axis M +<br />
jsNaM- &hellip; Joystick N axis M -<br />
jsNbM    &hellip; Joystick N button M</p>

<p>-i, &ndash;input KEYS        Use the 8 given input KEYS for respectively<br />
                    START SELECT A B UP DOWN LEFT RIGHT</p>

<p>Die Auflösung von 160×144 Pixel kann mit Parameter s auf 320x288 verdoppelt werden, wenn mindestens 640x480 zur Verfügung stehen.</p>

<p>-s, &ndash;scale N           Scale video output by an integer factor of N</p>

<p>Nun kann Gambatte mit allen Parametern gestartet werden.</p>

<pre><code>gambatte -s 2 -y -i js0b3 js0b2 js0b0 js0b1 js0a1- js0a1+ js0a0- js0a0+ Skoardy.gb &amp;
</code></pre>

<h2 id="youtube-video">Youtube Video</h2>

<p><a href="https://www.youtube.com/watch?v=6zO5fgMRnh0"><img src="http://img.youtube.com/vi/6zO5fgMRnh0/0.jpg" alt="GPIO Maus Video" /></a></p>
            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  
    <div class="entry-categories"><p><span>Kategorien</span>
  
    
    <a href="/categories/raspberry-pi" title="View all posts in Raspberry Pi">Raspberry Pi</a>
    <a href="/categories/programmierung" title="View all posts in Programmierung">Programmierung</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  

</p></div>	</div>

	
<div class="author-meta">

  <div class="author">
    	
    <img alt='Martin Strohmayer' src="https://www.gravatar.com/avatar/dc376a825706457b68caa281714897d5?s=100&d=identicon" class='avatar avatar-72 photo' height='72' width='72'>
    
    <span>
      Geschrieben von:<a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a> </span>
    </div>
    <div class="bio">
      
      
      <p>Softwareentwickler und Raspberry Pi Enthusiast.</p>
        
      
	
      

    


  
  <a class="twitter" target="_blank"
  href="https://twitter.com/m_stroh">
  <i class="fab fa-twitter-square"
  title="twitter icon"></i>
</a>




<a class="email" target="_blank"
href="mailto:martin.strohmayer@gc2.at">
<i class="fas fa-envelope"
title="email icon"></i>
</a>







<a class="github" target="_blank"
href="https://github.com/mstroh76">
<i class="fab fa-github"
title="github icon"></i>
</a>









</div>
</div>

</div>
</div>

<section id="comments" class="comments">




<script src="https://utteranc.es/client.js"
        repo="GrazerComputerClub/Blog"
        issue-term="title"
        
        theme="github-light"
        
        crossorigin="anonymous"
        async>
</script>


  

  




</section>
</div>

 



    </div>

    
<footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> GC2 Blog </a>
    
	</h1>

			
			<p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        
        <li>
        <a href="https://twitter.com/_gc2_"  class="twitter" target="_blank">
            <i class="fab fa-twitter-square" title="twitter"></i>
            <span class="screen-reader-text">twitter</span>
        </a>
        </li>
        

        

        
        <li>
        <a href="mailto:blog@gc2.at"  class="email">
            <i class="fas fa-envelope" title="email"></i>
            <span class="screen-reader-text">email</span>
        </a>
        </li>
        

        

        


        
        <li>
        <a href="https://github.com/GrazerComputerClub/"  class="github" target="_blank">
            <i class="fab fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        


        

        
        <li>
        <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
            <i class="fas fa-rss" title="rss"></i>
            <span class="screen-reader-text">rss</span>
        </a>
        </li>
        

				</ul>	<div class="design-credit">
		
		<p>CC-BY-4.0 <a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
		
		<p>2018, Grazer Computer Club e. V.</p>
		
		<p>Nederburg Hugo Theme by <a href="https://appernetic.io">Appernetic</a>.</p>
		
	</div>
</footer>

  </div>
  <script src="https://blog.gc2.at/js/jquery.min.js"></script>
<script src="https://blog.gc2.at/js/jquerymigrate.js"></script>
<script src="https://blog.gc2.at/js/production.min.js?v=1583694825"></script>

</body>
</html>
