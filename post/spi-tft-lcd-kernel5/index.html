<!DOCTYPE html>
<html lang="de-de">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/blog.gc2.at"
        },
        "articleSection" : "post",
        "name" : "SPI TFT LCD - Kernel 5",
        "headline" : "SPI TFT LCD - Kernel 5",
        "description" : "\x3cp\x3eFür eine Anzeige abseits von HDMI und Composite bieten sich günstige SPI TFT LCDs an. Diese gibt es in unterschiedlichen Auflösungen und Größen. Die Einbindung ist seit Kernel 5 nicht mehr über das Kernelmodul fbtft möglich. Man kann aber das Programm fbcp-ili9341 nutzen.\x3c\/p\x3e",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-11-09 00:00:00 \x2b0000 UTC",
        "dateModified" : "2020-11-09 00:00:00 \x2b0000 UTC",
        "url" : "https:\/\/blog.gc2.at\/post\/spi-tft-lcd-kernel5\/",
        "wordCount" : "822",
        "image" : "https://blog.gc2.atimg/SPI-LCD-TFT-fbcp-ili9341.jpg"",
        "keywords" : [ "Blog" ]   
    }
    </script>


 <title>SPI TFT LCD - Kernel 5 </title>


<meta name="description" content="Blog des Grazer Computer Club - GC2" />



<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link href="https://blog.gc2.at/css/style.css?v=1642174860" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://blog.gc2.at/css/custom.css?v=1642174860" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://blog.gc2.at/img/favicon.ico" type="image/x-icon">


<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	if (window.sessionStorage) {
		var GA_SESSION_STORAGE_KEY = 'ga:clientId';
		ga('create', 'UA-130665257-1', {
	    'storage': 'none',
	    'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
	   });
	   ga(function(tracker) {
	    sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
	   });
   }
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">

  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fas fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/ccc">ccc</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/gc2">gc2</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/minecraft">minecraft</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/programmierung">programmierung</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi">raspberry-pi</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/raspberry-pi-zero">raspberry-pi-zero</a>
        </li>
        
        <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
          <a href="/categories/uc">uc</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    
    <li>
      <a href="https://twitter.com/_gc2_" data-animate-hover="pulse" class="twitter" target="_blank">
        <i class="fab fa-twitter-square" title="twitter"></i>
        <span class="screen-reader-text">twitter</span>
      </a>
    </li>
    

    

    
    <li>
      <a href="mailto:blog@gc2.at" data-animate-hover="pulse" class="email">
        <i class="fas fa-envelope" title="email"></i>
        <span class="screen-reader-text">email</span>
      </a>
    </li>
    

    

    


    
    <li>
      <a href="https://github.com/GrazerComputerClub/" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fab fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    


    

    
    <li>
      <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
        <i class="fas fa-rss" title="rss"></i>
        <span class="screen-reader-text">rss</span>
      </a>
    </li>
    


  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> GC2 Blog </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fas fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/index.html">Blog (Deutsch)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://grazercomputerclub.github.io/BlogEN/index.html">Blog (English)</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="https://blog.gc2.at/impressum/">Impressum</a>
          
        </li>
        
        <li class='menu-item menu-item-type-post_type menu-item-object-page '>
          <a href="http://gc2.at">Hauptseite</a>
          
        </li>
        
      </ul>
    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  
  
    
  
  
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image'  data-background="https://blog.gc2.at/img/SPI-LCD-TFT-fbcp-ili9341.jpg">
      </div>
      
        <div class="entry-meta">
          <span class="date">09 November</span>	<span> / </span>

          <span class="author">
            <a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a>
          </span>


          
          <span class="category">
            <span> / </span>

            <a href="/categories/raspberry-pi">Raspberry Pi</a>
          </span>
          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'> SPI TFT LCD - Kernel 5</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              <p>Für eine Anzeige abseits von HDMI und Composite bieten sich günstige SPI TFT LCDs an. Diese gibt es in unterschiedlichen Auflösungen und Größen. Die Einbindung ist seit Kernel 5 nicht mehr über das Kernelmodul fbtft möglich. Man kann aber das Programm fbcp-ili9341 nutzen.</p>
<h2 id="allgemeines">Allgemeines</h2>
<p>SPI-Displays sind TFT-LCD-Anzeigen, die über den SPI-Bus an den Raspberry Pi angeschlossen werden können. Sie werden in unterschiedlichsten Auflösungen (128x128, 160x128, 240x240, 320x240 usw.) und Größen (1,44“ - 2,8“ usw.) angeboten. Es gibt allerdings verschiedenste Kontroller für diese SPI-Displays, die unterschiedlich angesprochen werden. Früher konnte man sie über ein Kernel Modul  bzw. Overlay einbinden. Seit Kernel 5 ist dass aber nur mehr über entsprechende Overlays möglich. In userem Test funktionierten die Oberlays allerdings auch nicht obwohl sie mit Kernel 4 korrekt gearbeitet haben.</p>
<p>Als Alternative bietet sich das Projekt <a href="https://github.com/juj/fbcp-ili9341">fbcp-ili9341</a> an. Das Programm muss zuerst mit Kompilerparameter an das Display und die Verkabelung angepasst werden. Desweiteren können noch einige weitere Anpassungen vorgenommen werden. Das Programm kann entsprechend des Zielsystems bzw. dem Raspberry Pi optimiert werden. Wir wählen die Anpassung an den Raspberry Pi Zero, damit es mit allen Systemen verwendet werden kann.<br>
Nach dem Kompilieren bzw. Erstellen des Programms kanne es gestartet werden. Dann zeigt das SPI-Display die Grafikausgabe des Raspberry Pi an. Es kopiert also den Inhalt der Grafikkarte auf das Display und skaliert es entsprechend um. Dies hat vor allem den Vorteil, dass Optimierungen und Grafikbeschleunigungen der Grafikkarte (GPU) auch für das SPI-Display funktionieren.<br>
Die Dekodierung von Videos passiert bei der Raspberry Pi in der GPU, so ist es auch auf dem langsamen Raspberry Pi Zero möglich Video abzuspielen.<br>
Mit dem Programm &lsquo;fbcp-ili9341&rsquo; kann diese ständige Kopieroperation nun im Hintergrund mit geringer CPU-Last erledigt werden. Dabei wird sogar das Bild auf die Auflösung des SPI-Displays angepasst. Das gilt für die Konsole, für X-Windows und auch für die Videoausgabe. Man kann also auch flüssig Videos auf einem 160x128 Displays ausgeben.</p>
<p>Günstige SPI-Displays mit einem unterstützten Kontroller sind z. B.:</p>
<table>
<thead>
<tr>
<th>Kontroller</th>
<th align="center">Auflösung</th>
<th align="center">Größe</th>
<th align="center">ca. Preis China</th>
</tr>
</thead>
<tbody>
<tr>
<td>ST7735S</td>
<td align="center">128x128</td>
<td align="center">1,44&rdquo;</td>
<td align="center">3 €</td>
</tr>
<tr>
<td>ST7735R</td>
<td align="center">160x128</td>
<td align="center">1,8&rdquo;</td>
<td align="center">4 €</td>
</tr>
<tr>
<td>ST7789VW</td>
<td align="center">240x240</td>
<td align="center">1,3&rdquo;</td>
<td align="center">3 €</td>
</tr>
<tr>
<td>ILI9341</td>
<td align="center">320x240</td>
<td align="center">2,2-2,8&rdquo;</td>
<td align="center">8 €</td>
</tr>
</tbody>
</table>
<p>Ein Problem stellt die Framerate dar, weil der SPI-Bus des Controllers nur eine limitierte Übertagungsrate unterstützt. Bei den kleinen Displays sind dann durchaus 30 FPS (Bilder pro Sekunde) möglich. Bei 320x240 sind bei der Raspberry Pi Zero allerdings nur 10-20 FPS möglich.<br>
Die theoretische minimale nötige Übertragungsrate bzw. SPI-Taktfrequenz kann man sich für 25 FPS und 16 Bit Farben leicht berechnen. Bei einer Auflösung von 160x128 ergibt sich eine Übertragungsrate von min. 8 MBit/s (8 MHz). Bei 320x240 allerdings bereits 41 MBit/s (41 MHz).<br>
Die SPI-Taktfrequenz wird aus dem System Takt also der &ldquo;core_freq&rdquo; gebildet. Mit dem Befehl <code>vcgencmd measure_clock core</code> kann die aktuelle Frequenz ermittelt werden. Man muss hier den entsprechenden geradzahligen Divisor als Parameter angeben. Bei typischerweise 400 MHz Takt wird mit dem Divisor 8 also 50 MHz und mit Divisor 6 wird 67 MHz erzeugt.</p>
<table>
<thead>
<tr>
<th>Core Takt</th>
<th align="center">Divisor</th>
<th align="center">SPI-Frequenz</th>
</tr>
</thead>
<tbody>
<tr>
<td>250 MHz</td>
<td align="center">4</td>
<td align="center">62,5 MHz</td>
</tr>
<tr>
<td>250 MHz</td>
<td align="center">6</td>
<td align="center">41,7 MHz</td>
</tr>
<tr>
<td>250 MHz</td>
<td align="center">8</td>
<td align="center">31,3 MHz</td>
</tr>
<tr>
<td>250 MHz</td>
<td align="center">10</td>
<td align="center">25,0 MHz</td>
</tr>
<tr>
<td>400 MHz</td>
<td align="center">4</td>
<td align="center">100 MHz</td>
</tr>
<tr>
<td>400 MHz</td>
<td align="center">6</td>
<td align="center">66,7 MHz</td>
</tr>
<tr>
<td>400 MHz</td>
<td align="center">8</td>
<td align="center">50,0 MHz</td>
</tr>
<tr>
<td>400 MHz</td>
<td align="center">10</td>
<td align="center">40,0 MHz</td>
</tr>
<tr>
<td>500 MHz</td>
<td align="center">4</td>
<td align="center">125 MHz</td>
</tr>
<tr>
<td>500 MHz</td>
<td align="center">6</td>
<td align="center">83,3 MHz</td>
</tr>
<tr>
<td>500 MHz</td>
<td align="center">8</td>
<td align="center">62,5 MHz</td>
</tr>
<tr>
<td>500 MHz</td>
<td align="center">10</td>
<td align="center">50,0 MHz</td>
</tr>
</tbody>
</table>
<p>Divisor 8:</p>
<table>
<thead>
<tr>
<th>Core Takt</th>
<th align="center">SPI-Frequenz</th>
</tr>
</thead>
<tbody>
<tr>
<td>250 MHz</td>
<td align="center">31,3 MHz</td>
</tr>
<tr>
<td>400 MHz</td>
<td align="center">50,0 MHz</td>
</tr>
<tr>
<td>500 MHz</td>
<td align="center">62,5 MHz</td>
</tr>
</tbody>
</table>
<p>Im Test lag nämlich die maximale SPI-Taktfrequenz des ST7735R-Controllers bei ca. 50 MHz und beim ILI9341-Controller bei ca. 66 MHz.
Der SPI-Bus Kanal kann nicht parametriert werden, es wird immer SPIO verwendet. Es wird auch empfohlen den SPI Bus in der Datei config.txt zu deaktivieren, damit es keine Probleme und Wechselwirkungen gibt.</p>
<p>Auf der Projektseite sind alle Parameter genau beschreiben. Bei Unklarhieten muss hier nachgelesen werden.</p>
<h2 id="kontakte">Kontakte</h2>
<p>Zur Ansteuerung des Displays werden folgende Kontakte bzw. GPIOs verwendet:<br>
<strong>VCC</strong> &hellip; Versorgung (meist 5 oder 3,3 V)<br>
<strong>VLED</strong> &hellip; Versorgung Hintergrundbeleuchtung (optional, meist 3,3 V)<br>
<strong>GND</strong> &hellip; Masse<br>
<strong>MOSI</strong> &hellip; Datenleitung<br>
<strong>CLK</strong> &hellip; SPI-Takt<br>
<strong>CS</strong> &hellip; SPI Slave Aktivierung<br>
<strong>RESET</strong> &hellip; Reset<br>
<strong>DC/A0/RS</strong> &hellip; Umschaltung Befehl oder Daten Übertagung</p>
<p>Die Kontakte RESET und DC/A0/RS können über Parameter frei zugewiesen werden. Wobei CS immer auf CS0 gesetzt werden muss. RESET wird auf GPIO25 und DC/A0/RS auf GPIO24. MOSI und CLK werden auf die entsprechenden SPI-Bus Anschlüsse verbunden.</p>
<p><img src="../../img/SPI-LCD-TFT_Steckplatine.png" alt="SPI-LCD-TFT Anschluss"></p>
<h2 id="erstellung-für-18-160x128-display-mit-st7735r-kontroller">Erstellung für 1,8&rdquo; 160x128 Display mit ST7735R Kontroller</h2>
<pre><code>sudo apt-get install cmake
cd ~
git clone https://github.com/juj/fbcp-ili9341.git
cd fbcp-ili9341
mkdir build
cd build
cmake -DST7735R=ON -DGPIO_TFT_DATA_CONTROL=24 -DGPIO_TFT_RESET_PIN=25 -DSPI_BUS_CLOCK_DIVISOR=8 -DSINGLE_CORE_BOARD=ON -DARMV6Z=ON -DSTATISTICS=0 -DDISPLAY_ROTATE_180_DEGREES=ON ..
make -j
</code></pre><p>Mit <code>sudo ./fbcp-ili9341</code> kann das Programm dann gestartet werden.</p>
<p>Parameter Pi-XO:</p>
<p>1,8&rdquo; 160x128 Display mit ST7735R Kontroller:</p>
<pre><code>cmake -DST7735R=ON -DGPIO_TFT_DATA_CONTROL=5 -DGPIO_TFT_RESET_PIN=6 -DSPI_BUS_CLOCK_DIVISOR=8 -DSINGLE_CORE_BOARD=ON -DDISPLAY_SWAP_BGR=ON -DARMV6Z=ON -DSTATISTICS=0 -DDISPLAY_ROTATE_180_DEGREES=OFF ..
</code></pre><p>2,2&rdquo; 320x240 Display mit ili9341 Kontroller:</p>
<pre><code>cmake -DILI9341=ON -DGPIO_TFT_DATA_CONTROL=5 -DGPIO_TFT_RESET_PIN=6 -DSPI_BUS_CLOCK_DIVISOR=8 -DSINGLE_CORE_BOARD=ON -DARMV6Z=ON -DSTATISTICS=0 -DDISPLAY_ROTATE_180_DEGREES=OFF ..
</code></pre><p>Waveshare HAT 1,44&rdquo; 128x128 Display mit ST7735S Kontroller:</p>
<pre><code>cmake -DWAVESHARE_ST7735S_HAT=ON -DSPI_BUS_CLOCK_DIVISOR=8 -DSINGLE_CORE_BOARD=ON -DARMV6Z=ON -DSTATISTICS=0 -DDISPLAY_ROTATE_180_DEGREES=OFF ..
</code></pre><h2 id="verlinkungen">Verlinkungen</h2>
<p>GitHub Projekt <a href="https://github.com/juj/fbcp-ili9341">fbcp-ili9341</a></p>
            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  
    <div class="entry-categories"><p><span>Kategorie</span>
  
    
    <a href="/categories/raspberry-pi" title="View all posts in Raspberry Pi">Raspberry Pi</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  

</p></div>	</div>

	
<div class="author-meta">

  <div class="author">
    	
    <img alt='Martin Strohmayer' src="https://www.gravatar.com/avatar/dc376a825706457b68caa281714897d5?s=100&d=identicon" class='avatar avatar-72 photo' height='72' width='72'>
    
    <span>
      Geschrieben von:<a href="http://strohmayers.com" title="Posts von Martin Strohmayer" rel="author">Martin Strohmayer</a> </span>
    </div>
    <div class="bio">
      
      
      <p>Softwareentwickler und Raspberry Pi Enthusiast.</p>
        
      
	
      

    


  
  <a class="twitter" target="_blank"
  href="https://twitter.com/m_stroh">
  <i class="fab fa-twitter-square"
  title="twitter icon"></i>
</a>




<a class="email" target="_blank"
href="mailto:martin.strohmayer@gc2.at">
<i class="fas fa-envelope"
title="email icon"></i>
</a>







<a class="github" target="_blank"
href="https://github.com/mstroh76">
<i class="fab fa-github"
title="github icon"></i>
</a>









</div>
</div>

</div>
</div>

<section id="comments" class="comments">




<script src="https://utteranc.es/client.js"
        repo="GrazerComputerClub/Blog"
        issue-term="title"
        
        theme="github-light"
        
        crossorigin="anonymous"
        async>
</script>


  

  




</section>
</div>

 



    </div>

    
<footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> GC2 Blog </a>
    
	</h1>

			
			<p class="site-description">Infos rund um Computer, Programmierung, Elektronik und sonstige Informatik</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        
        <li>
        <a href="https://twitter.com/_gc2_"  class="twitter" target="_blank">
            <i class="fab fa-twitter-square" title="twitter"></i>
            <span class="screen-reader-text">twitter</span>
        </a>
        </li>
        

        

        
        <li>
        <a href="mailto:blog@gc2.at"  class="email">
            <i class="fas fa-envelope" title="email"></i>
            <span class="screen-reader-text">email</span>
        </a>
        </li>
        

        

        


        
        <li>
        <a href="https://github.com/GrazerComputerClub/"  class="github" target="_blank">
            <i class="fab fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        


        

        
        <li>
        <a href="https://blog.gc2.at/index.xml" data-animate-hover="pulse" class="rss" target="_blank">
            <i class="fas fa-rss" title="rss"></i>
            <span class="screen-reader-text">rss</span>
        </a>
        </li>
        

				</ul>	<div class="design-credit">
		
		<p>CC-BY-4.0 <a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
		
		<p>2018, Grazer Computer Club e. V.</p>
		
		<p>Nederburg Hugo Theme by <a href="https://appernetic.io">Appernetic</a>.</p>
		
	</div>
</footer>

  </div>
  <script src="https://blog.gc2.at/js/jquery.min.js"></script>
<script src="https://blog.gc2.at/js/jquerymigrate.js"></script>
<script src="https://blog.gc2.at/js/production.min.js?v=1642174860"></script>

</body>
</html>
